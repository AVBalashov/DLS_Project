# DLS_Project
*	Данный репозиторий представляет собой финальный проект в Школе Глубокого Обучение МФТИ (Deep Learning School).
*	Проект представляет из себя телеграм бота, который может перенести стиль с одной фотографии на другую.
*	Код, представленный здесь запущен на сервере heroku.
*	Бот работает автономно 24/7: @ImageStyleDLSBot https://telegram.me/ImageStyleDLSBot
*	Используется медленный алгоритм переноса стиля, который был рассмотрен на лекции.
*	Все вычисления выполняются на cpu, поэтому процесс переноса стиля на изображение занимает ~ 3-5 минут.
*	Прием сообщений ботом от пользователя осуществляются в асинхронном режиме.

## main.py
Данный файл содержит основной код бота: хендлеры для обработки сообщений пользователя и диалог для запуска переноса стиля и вывода результата пользователю.

## model.py
Модуль в котором реализована сверточная модель для переноса стиля. Модель основана на пяти верхних свертках VGG-19, обученной на IMAGANET. Т.к. сама VGG-19 весит около 500 Мб, то в данном модуле реализована функция для того, чтобы воспроизводить верхние слои данной модели и загружать предобученные веса только лишь для них. Таким образом, на выходе получаем файл размером около 2Мб.

## config.py
В данном файле находятся основные настройки бота:
*	ключ авторизации бота (удален по соображениям безопасности);
*	имя файла сохраненой модели;
*	размер изображения для обработки для режима работы на CPU;
*	размер изображения для обработки для режима работы на GPU.

## vgg19_cache.pth
Предобученные веса для верхних слоев VGG-19.

## Procfile
Данный файл необходим для сервера heroku. В котором указываются инструкции как развернутое приложение должно выполняться.

## requirements.txt
Данный файл, содержит список необходимых сторонних пакетов Python.

## Runtime.txt
Данный файл, сообщает Heroku, какую версию Python использует приложение.

## Асинхронный режим
Прием и обработка пользовательских сообщений ботом осуществляется в асинхронном режиме. Данный режим реализован посредством модуля threading.

## Развертывание
Проект запущен на сервере heroku. Сервер heroku в бесплатном режиме позволяет развернуть приложение, размер которого, со всеми зависимостями, не должен превышать 500Мб. В связи с этим, для запуска проекта была использован фреймворк torch версии 0.4.1, который может быть запущен на Python версии 3.6.15. Данную версию интерпретатора на сервере heroku-20 (United States).

## Итоговый результат
* Фотография которой необходимо применить стиль:

![](https://github.com/AVBalashov/DLS_Project/raw/master/img/photo_2022-02-12_22-30-55.jpg)
* Фотография стиля:

![](https://github.com/AVBalashov/DLS_Project/raw/master/img/photo_2022-02-12_22-31-01.jpg)
* Результат применения стиля:

![](https://github.com/AVBalashov/DLS_Project/raw/master/img/photo_2022-02-13_14-17-01.jpg)

* Интерфейс телеграм бота:

![](https://github.com/AVBalashov/DLS_Project/raw/master/img/02.png)

![](https://github.com/AVBalashov/DLS_Project/raw/master/img/01.png)
